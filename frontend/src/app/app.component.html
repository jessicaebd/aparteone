<ngx-spinner bdColor="rgba(51,51,51,0.8)" size="large" color="#fff" type="ball-scale-multiple">
  <p style="font-size: 20px; color: white">Loading...</p>
</ngx-spinner>

<div class="container-fluid">
  <ng-container *ngIf="isLogin==true; else guest">
    <div class="row">
    <!-- Sidebar -->
    <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
      <div class="position-sticky px-3">
        <div class="d-flex row align-items-center">
          <div class="logo mb-3">
            <img width="200" alt="logo" src="assets/general/LOGO.svg" />
          </div>
          <hr />

          <a [ngClass]="
              activeNav == 'home'
                ? 'navbar-item py-3 active'
                : 'navbar-item py-3'
            " routerLink="/" data-bs-dismiss="offcanvas" (click)="onNavbarActive('home')">
            <i *ngIf="activeNav == 'home'" class="navbar-icon bi bi-house-fill"
              style="color: var(--primary-purple)"></i>
            <i *ngIf="activeNav != 'home'" class="navbar-icon bi bi-house" style="color: var(--black)"></i>
            <label class="navbar-name ms-2">Home</label>
          </a>
        </div>

        <!-- Admin -->
        <ng-container *ngIf="user.role == 'Admin'">
          <div class="d-flex row align-items-center">
            <a [ngClass]="
                activeNav == 'apartment'
                  ? 'navbar-item py-3 active'
                  : 'navbar-item py-3'
              " routerLink="/apartment" data-bs-dismiss="offcanvas" (click)="onNavbarActive('apartment')">
              <i *ngIf="activeNav == 'apartment'" class="navbar-icon bi bi-building-fill"
                style="color: var(--primary-purple)"></i>
              <i *ngIf="activeNav != 'apartment'" class="navbar-icon bi bi-building"
                style="color: var(--black)"></i>
              <label class="navbar-name ms-2">Apartment</label>
            </a>
          </div>
          <div class="d-flex row align-items-center">
            <a [ngClass]="
                activeNav == 'resident'
                  ? 'navbar-item py-3 active'
                  : 'navbar-item py-3'
              " routerLink="/resident" data-bs-dismiss="offcanvas" (click)="onNavbarActive('resident')">
              <i *ngIf="activeNav == 'resident'" class="navbar-icon bi bi-people-fill"
                style="color: var(--primary-purple)"></i>
              <i *ngIf="activeNav != 'resident'" class="navbar-icon bi bi-people" style="color: var(--black)"></i>
              <label class="navbar-name ms-2">Residents</label>
            </a>
          </div>
          <div class="d-flex row align-items-center">
            <a [ngClass]="
                activeNav == 'merchant'
                  ? 'navbar-item py-3 active'
                  : 'navbar-item py-3'
              " routerLink="/merchant" data-bs-dismiss="offcanvas" (click)="onNavbarActive('merchant')">
              <i *ngIf="activeNav == 'merchant'" class="navbar-icon bi bi-shop-window"
                style="color: var(--primary-purple)"></i>
              <i *ngIf="activeNav != 'merchant'" class="navbar-icon bi bi-shop"
                style="color: var(--black)"></i>
              <label class="navbar-name ms-2">Merchant</label>
            </a>
          </div>
        </ng-container>

        <!-- Management -->
        <ng-container *ngIf="user.role == 'Management'">
          <div class="d-flex row align-items-center">
            <a [ngClass]="
                activeNav == 'apartment'
                  ? 'navbar-item py-3 active'
                  : 'navbar-item py-3'
              " routerLink="/apartment" data-bs-dismiss="offcanvas" (click)="onNavbarActive('apartment')">
              <i *ngIf="activeNav == 'apartment'" class="navbar-icon bi bi-building-fill"
                style="color: var(--primary-purple)"></i>
              <i *ngIf="activeNav != 'apartment'" class="navbar-icon bi bi-building"
                style="color: var(--black)"></i>
              <label class="navbar-name ms-2">Units</label>
            </a>
          </div>
          <div class="d-flex row align-items-center">
            <a [ngClass]="
                activeNav == 'announcement'
                  ? 'navbar-item py-3 active'
                  : 'navbar-item py-3'
              " routerLink="/announcement" data-bs-dismiss="offcanvas" (click)="onNavbarActive('announcement')">
              <i *ngIf="activeNav == 'announcement'" class="navbar-icon bi bi-megaphone-fill"
                style="color: var(--primary-purple)"></i>
              <i *ngIf="activeNav != 'announcement'" class="navbar-icon bi bi-megaphone" style="color: var(--black)"></i>
              <label class="navbar-name ms-2">Announcement</label>
            </a>
          </div>
          <div class="d-flex row align-items-center">
            <a [ngClass]="
                activeNav == 'billing'
                  ? 'navbar-item py-3 active'
                  : 'navbar-item py-3'
              " routerLink="/billing" data-bs-dismiss="offcanvas" (click)="onNavbarActive('billing')">
              <i *ngIf="activeNav == 'billing'" class="navbar-icon bi bi-cash-coin"
                style="color: var(--primary-purple)"></i>
              <i *ngIf="activeNav != 'billing'" class="navbar-icon bi bi-cash"
                style="color: var(--black)"></i>
              <label class="navbar-name ms-2">Bills</label>
            </a>
          </div>
          <div class="d-flex row align-items-center">
            <a [ngClass]="
                activeNav == 'mailbox'
                  ? 'navbar-item py-3 active'
                  : 'navbar-item py-3'
              " routerLink="/mailbox" data-bs-dismiss="offcanvas" (click)="onNavbarActive('mailbox')">
              <i *ngIf="activeNav == 'mailbox'" class="navbar-icon bi bi-envelope-open-fill"
                style="color: var(--primary-purple)"></i>
              <i *ngIf="activeNav != 'mailbox'" class="navbar-icon bi bi-envelope" style="color: var(--black)"></i>
              <label class="navbar-name ms-2">Mailbox</label>
            </a>
          </div>

          <div class="d-flex row align-items-center">
            <a [ngClass]="
                activeNav == 'facility'
                  ? 'navbar-item py-3 active'
                  : 'navbar-item py-3'
              " routerLink="/facility" data-bs-dismiss="offcanvas" (click)="onNavbarActive('facility')">
              <i *ngIf="activeNav == 'facility'" class="navbar-icon bi bi-calendar-check-fill"
                style="color: var(--primary-purple)"></i>
              <i *ngIf="activeNav != 'facility'" class="navbar-icon bi bi-calendar-check"
                style="color: var(--black)"></i>
              <label class="navbar-name ms-2">Facility</label>
            </a>
          </div>
          <div class="d-flex row align-items-center">
            <a [ngClass]="
                activeNav == 'maintenance'
                  ? 'navbar-item py-3 active'
                  : 'navbar-item py-3'
              " routerLink="/maintenance" data-bs-dismiss="offcanvas" (click)="onNavbarActive('maintenance')">
              <i *ngIf="activeNav == 'maintenance'" class="navbar-icon bi bi-gear-fill"
                style="color: var(--primary-purple)"></i>
              <i *ngIf="activeNav != 'maintenance'" class="navbar-icon bi bi-gear" style="color: var(--black)"></i>
              <label class="navbar-name ms-2">Maintenance</label>
            </a>
          </div>

          <div class="d-flex row align-items-center">
            <a [ngClass]="
                activeNav == 'resident'
                  ? 'navbar-item py-3 active'
                  : 'navbar-item py-3'
              " routerLink="/resident" data-bs-dismiss="offcanvas" (click)="onNavbarActive('resident')">
              <i *ngIf="activeNav == 'resident'" class="navbar-icon bi bi-people-fill"
                style="color: var(--primary-purple)"></i>
              <i *ngIf="activeNav != 'resident'" class="navbar-icon bi bi-people" style="color: var(--black)"></i>
              <label class="navbar-name ms-2">Residents</label>
            </a>
          </div>
          <div class="d-flex row align-items-center">
            <a [ngClass]="
                activeNav == 'merchant'
                  ? 'navbar-item py-3 active'
                  : 'navbar-item py-3'
              " routerLink="/merchant" data-bs-dismiss="offcanvas" (click)="onNavbarActive('merchant')">
              <i *ngIf="activeNav == 'merchant'" class="navbar-icon bi bi-shop-window"
                style="color: var(--primary-purple)"></i>
              <i *ngIf="activeNav != 'merchant'" class="navbar-icon bi bi-shop" style="color: var(--black)"></i>
              <label class="navbar-name ms-2">E-Mart</label>
            </a>
          </div>
          <div class="d-flex row align-items-center">
            <a [ngClass]="
                activeNav == 'report'
                  ? 'navbar-item py-3 active'
                  : 'navbar-item py-3'
              " routerLink="/report" data-bs-dismiss="offcanvas" (click)="onNavbarActive('report')">
              <i *ngIf="activeNav == 'report'" class="navbar-icon bi bi-question-circle-fill"
                style="color: var(--primary-purple)"></i>
              <i *ngIf="activeNav != 'report'" class="navbar-icon bi bi-question-circle"
                style="color: var(--black)"></i>
              <label class="navbar-name ms-2">Report</label>
            </a>
          </div>
        </ng-container>

        <!-- Resident -->
        <ng-container *ngIf="user.role == 'Resident'">
          <div class="d-flex row align-items-center">
            <a [ngClass]="
                activeNav == 'billing'
                  ? 'navbar-item py-3 active'
                  : 'navbar-item py-3'
              " routerLink="/billing" data-bs-dismiss="offcanvas" (click)="onNavbarActive('billing')">
              <i *ngIf="activeNav == 'billing'" class="navbar-icon bi bi-cash-coin"
                style="color: var(--primary-purple)"></i>
              <i *ngIf="activeNav != 'billing'" class="navbar-icon bi bi-cash"
                style="color: var(--black)"></i>
              <label class="navbar-name ms-2">Bills</label>
            </a>
          </div>
          <div class="d-flex row align-items-center">
            <a [ngClass]="
                activeNav == 'mailbox'
                  ? 'navbar-item py-3 active'
                  : 'navbar-item py-3'
              " routerLink="/mailbox" data-bs-dismiss="offcanvas" (click)="onNavbarActive('mailbox')">
              <i *ngIf="activeNav == 'mailbox'" class="navbar-icon bi bi-envelope-open-fill"
                style="color: var(--primary-purple)"></i>
              <i *ngIf="activeNav != 'mailbox'" class="navbar-icon bi bi-envelope" style="color: var(--black)"></i>
              <label class="navbar-name ms-2">Mailbox</label>
            </a>
          </div>

          <div class="d-flex row align-items-center">
            <a [ngClass]="
                activeNav == 'facility'
                  ? 'navbar-item py-3 active'
                  : 'navbar-item py-3'
              " routerLink="/facility" data-bs-dismiss="offcanvas" (click)="onNavbarActive('facility')">
              <i *ngIf="activeNav == 'facility'" class="navbar-icon bi bi-calendar-check-fill"
                style="color: var(--primary-purple)"></i>
              <i *ngIf="activeNav != 'facility'" class="navbar-icon bi bi-calendar-check"
                style="color: var(--black)"></i>
              <label class="navbar-name ms-2">Facility</label>
            </a>
          </div>
          <div class="d-flex row align-items-center">
            <a [ngClass]="
                activeNav == 'maintenance'
                  ? 'navbar-item py-3 active'
                  : 'navbar-item py-3'
              " routerLink="/maintenance" data-bs-dismiss="offcanvas" (click)="onNavbarActive('maintenance')">
              <i *ngIf="activeNav == 'maintenance'" class="navbar-icon bi bi-gear-fill"
                style="color: var(--primary-purple)"></i>
              <i *ngIf="activeNav != 'maintenance'" class="navbar-icon bi bi-gear" style="color: var(--black)"></i>
              <label class="navbar-name ms-2">Maintenance</label>
            </a>
          </div>

          <div class="d-flex row align-items-center">
            <a [ngClass]="
                activeNav == 'merchant'
                  ? 'navbar-item py-3 active'
                  : 'navbar-item py-3'
              " routerLink="/merchant" data-bs-dismiss="offcanvas" (click)="onNavbarActive('merchant')">
              <i *ngIf="activeNav == 'merchant'" class="navbar-icon bi bi-shop-window"
                style="color: var(--primary-purple)"></i>
              <i *ngIf="activeNav != 'merchant'" class="navbar-icon bi bi-shop" style="color: var(--black)"></i>
              <label class="navbar-name ms-2">E-Mart</label>
            </a>
          </div>
          <div class="d-flex row align-items-center">
            <a [ngClass]="
                activeNav == 'transaction'
                  ? 'navbar-item py-3 active'
                  : 'navbar-item py-3'
              " routerLink="/transaction" data-bs-dismiss="offcanvas" (click)="onNavbarActive('transaction')">
              <i *ngIf="activeNav == 'transaction'" class="navbar-icon bi bi-receipt-cutoff"
                style="color: var(--primary-purple)"></i>
              <i *ngIf="activeNav != 'transaction'" class="navbar-icon bi bi-receipt" style="color: var(--black)"></i>
              <label class="navbar-name ms-2">Transaction</label>
            </a>
          </div>
          <div class="d-flex row align-items-center">
            <a [ngClass]="
                activeNav == 'report'
                  ? 'navbar-item py-3 active'
                  : 'navbar-item py-3'
              " routerLink="/report" data-bs-dismiss="offcanvas" (click)="onNavbarActive('report')">
              <i *ngIf="activeNav == 'report'" class="navbar-icon bi bi-question-circle-fill"
                style="color: var(--primary-purple)"></i>
              <i *ngIf="activeNav != 'report'" class="navbar-icon bi bi-question-circle"
                style="color: var(--black)"></i>
              <label class="navbar-name ms-2">Report</label>
            </a>
          </div>
        </ng-container>

        <!-- Merchant -->
        <ng-container *ngIf="user.role == 'Merchant'">
          <div class="d-flex row align-items-center">
            <a [ngClass]="
              activeNav == 'product'
                ? 'navbar-item py-3 active'
                : 'navbar-item py-3'
            " routerLink="/product" data-bs-dismiss="offcanvas" (click)="onNavbarActive('product')">
              <i *ngIf="activeNav == 'product'" class="navbar-icon bi bi-basket2-fill"
                style="color: var(--primary-purple)"></i>
              <i *ngIf="activeNav != 'product'" class="navbar-icon bi bi-basket2" style="color: var(--black)"></i>
              <label class="navbar-name ms-2">Product</label>
            </a>
          </div>

          <div class="d-flex row align-items-center">
            <a [ngClass]="
              activeNav == 'transaction'
                ? 'navbar-item py-3 active'
                : 'navbar-item py-3'
            " routerLink="/transaction" data-bs-dismiss="offcanvas" (click)="onNavbarActive('transaction')">
              <i *ngIf="activeNav == 'transaction'" class="navbar-icon bi bi-receipt-cutoff"
                style="color: var(--primary-purple)"></i>
              <i *ngIf="activeNav != 'transaction'" class="navbar-icon bi bi-receipt" style="color: var(--black)"></i>
              <label class="navbar-name ms-2">Transaction</label>
            </a>
          </div>

          <div class="d-flex row align-items-center">
            <a [ngClass]="
              activeNav == 'chat'
                ? 'navbar-item py-3 active'
                : 'navbar-item py-3'
            " routerLink="/chat" data-bs-dismiss="offcanvas" (click)="onNavbarActive('chat')">
              <i *ngIf="activeNav == 'chat'" class="navbar-icon bi bi-chat-dots-fill"
                style="color: var(--primary-purple)"></i>
              <i *ngIf="activeNav != 'chat'" class="navbar-icon bi bi-chat-dots" style="color: var(--black)"></i>
              <label class="navbar-name ms-2">Chat</label>
            </a>
          </div>
        </ng-container>
      </div>
    </nav>

    <!-- Main content area -->
    <main class="col-md-9 ms-sm-auto col-lg-10">
      <!-- Topbar -->
      <ng-container *ngIf="isLogin==true; else topBarGuest">
        <div class="nav fixed fixed-top justify-content-end align-items-center p-3"
        style="background-color: var(--white); z-index: 0;">
          <label class="me-1" style="font-size: 1rem; font-weight: 500; color: var(--black)">Hello,</label>
          <ng-container *ngIf="user.name; else adminProfile">
            <app-label class="profile-name" [labelInput]="user.name"></app-label>
          </ng-container>
          <ng-template #adminProfile>
            <app-label class="profile-name" labelInput="Admin"></app-label>
          </ng-template>
          <div class="border-end pe-2">
            <div class="dropdown ms-2">
              <ng-container *ngIf="user.image; else defaultProfile">
                <button class="btn btn-profile rounded-circle p-0" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <img class="mx-0 rounded-circle" width="44" height="44" alt="profile" [src]="user.image" style="object-fit: cover;"/>
                </button>
              </ng-container>
              <ng-template #defaultProfile>
                <button class="btn btn-profile rounded-circle px-0" type="button" data-bs-toggle="dropdown" aria-expanded="false" style="width: 44px;">
                  <img class="mx-0 rounded-circle" width="30" height="30" alt="profile" src="assets/general/profile.svg" />
                </button>
              </ng-template>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" (click)="goToProfilePage()">Profile</a></li>
                <li><a class="dropdown-item" (click)="logOut()">Log Out</a></li>
              </ul>
            </div>
          </div>
          <button type="button" class="btn btn-notification position-relative ms-3 me-3" data-bs-toggle="modal" data-bs-target="#modalNotification">
            <i class="bi bi-bell-fill"></i>
            <span
            class="position-absolute top-0 start-100 translate-middle p-2 bg-danger border border-light rounded-circle">
              <span class="visually-hidden">New alerts</span>
            </span>
          </button>
        </div>
        
        <!-- Modal -->
        <app-modal modalID="modalNotification" [width]="600" [modalContent]="modalNotification"></app-modal>
        <ng-template #modalNotification>
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="staticBackdropLabel">Notifications</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" #closeModal></button>
          </div>
          <div class="modal-body d-flex col justify-content-center">
            <div class="container">
              <app-notification></app-notification>
            </div>
          </div>
        </ng-template>
      </ng-container>

      <ng-template #topBarGuest>
        <div class="nav fixed fixed-top justify-content-end align-items-center p-3" style="background-color: var(--white); z-index: 0;">
          <app-button buttonClass="primary" buttonLabel="Login" (onClickEvent)="goToLoginPage()"></app-button>
          <app-button class="ms-3" buttonClass="outline-primary" buttonLabel="Register" routerLink="/register"></app-button>
        </div>
      </ng-template>

      <!-- Content -->
      <main class="page container-fluid">
        <div class="content" role="main">
          <router-outlet></router-outlet>
        </div>
      </main>
    </main>
  </div>
  </ng-container>
</div>

<ng-template #guest>
  <div class="row">
  <!-- Main content area -->
  <main class="col-md ms-sm-auto col-lg">
    <!-- Topbar -->
    <ng-container *ngIf="isLogin==true; else topBarGuest">
      <div class="nav fixed fixed-top justify-content-end align-items-center p-3"
      style="background-color: var(--white); z-index: 0;">
        <label class="me-1" style="font-size: 1rem; font-weight: 500; color: var(--black)">Hello,</label>
        <ng-container *ngIf="user.name; else adminProfile">
          <app-label class="profile-name" [labelInput]="user.name"></app-label>
        </ng-container>
        <ng-template #adminProfile>
          <app-label class="profile-name" labelInput="Admin"></app-label>
        </ng-template>
        <div class="border-end pe-2">
          <div class="dropdown ms-2">
            <ng-container *ngIf="user.image; else defaultProfile">
              <button class="btn btn-profile rounded-circle p-0" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                <img class="mx-0 rounded-circle" width="44" height="44" alt="profile" [src]="user.image" style="object-fit: cover;"/>
              </button>
            </ng-container>
            <ng-template #defaultProfile>
              <button class="btn btn-profile rounded-circle px-0" type="button" data-bs-toggle="dropdown" aria-expanded="false" style="width: 44px;">
                <img class="mx-0 rounded-circle" width="30" height="30" alt="profile" src="assets/general/profile.svg" />
              </button>
            </ng-template>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" (click)="goToProfilePage()">Profile</a></li>
              <li><a class="dropdown-item" (click)="logOut()">Log Out</a></li>
            </ul>
          </div>
        </div>
        <button type="button" class="btn btn-notification position-relative ms-3 me-3" data-bs-toggle="modal" data-bs-target="#modalNotification">
          <i class="bi bi-bell-fill"></i>
          <span
          class="position-absolute top-0 start-100 translate-middle p-2 bg-danger border border-light rounded-circle">
            <span class="visually-hidden">New alerts</span>
          </span>
        </button>
      </div>
      
      <!-- Modal -->
      <app-modal modalID="modalNotification" [width]="600" [modalContent]="modalNotification"></app-modal>
      <ng-template #modalNotification>
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="staticBackdropLabel">Notifications</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" #closeModal></button>
        </div>
        <div class="modal-body d-flex col justify-content-center">
          <div class="container">
            <app-notification></app-notification>
          </div>
        </div>
      </ng-template>
    </ng-container>

    <ng-template #topBarGuest>
      <div class="nav fixed fixed-top justify-content-end align-items-center p-3" style="background-color: var(--white); z-index: 0;">
        <app-button buttonClass="primary" buttonLabel="Login" (onClickEvent)="goToLoginPage()"></app-button>
        <app-button class="ms-3" buttonClass="outline-primary" buttonLabel="Register" routerLink="/register"></app-button>
      </div>
    </ng-template>

    <!-- Content -->
    <main class="page container-fluid">
      <div class="mt-5 pt-3" role="main">
        <router-outlet></router-outlet>
      </div>
    </main>
  </main>
</div>
</ng-template>